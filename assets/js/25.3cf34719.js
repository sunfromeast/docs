(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{220:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"pv"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pv","aria-hidden":"true"}},[s._v("#")]),s._v(" PV")]),s._v(" "),t("h3",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),t("ul",[t("li",[s._v("PV是一种“资源”，是对底层网络共享存储的抽象。它定义了一个持久化存储在宿主机上的目录。")]),s._v(" "),t("li",[s._v("作为资源，包括：\n"),t("ul",[t("li",[s._v("存储能力（capacity）：当前仅支持对存储空间的设置（storage=xx）")]),s._v(" "),t("li",[s._v("访问模式（accessModes）\n"),t("ul",[t("li",[s._v("ReadWriteOnce（RWO）：读写权限，能被单个node挂载")]),s._v(" "),t("li",[s._v("ReadOnlyMany（ROX）：只读权限，允许被多个node挂载")]),s._v(" "),t("li",[s._v("ReadWriteMany（RWX）：读写权限，允许被多个node挂载")]),s._v(" "),t("li",[s._v("存储类型（Class)：设置存储的类别。通过"),t("code",[s._v("storageClassName")]),s._v("参数指定一个"),t("code",[s._v("StorageClass")]),s._v("资源对象名称。具有特定类别的PV只能与请求了该类别的PVC进行绑定。未设置类别的PV只能与不请求任何类别的PVC进行绑定。")])])]),s._v(" "),t("li",[s._v("回收策略（persistentVolumeReclaimPolicy）\n"),t("ul",[t("li",[s._v("保留（Retain）：保留数据，手工处理")]),s._v(" "),t("li",[s._v("回收空间（Recycle）：简单清除文件操作")]),s._v(" "),t("li",[s._v("删除（Delete）：与PV关联的后盾存储完成volume的删除工作。")])])]),s._v(" "),t("li",[s._v("后端存储类型")])])]),s._v(" "),t("li",[s._v("生命周期各个阶段\n"),t("ul",[t("li",[s._v("Available：可用")]),s._v(" "),t("li",[s._v("Bound：已绑定PVC")]),s._v(" "),t("li",[s._v("Released：绑定的PVC删除，资源以释放、")]),s._v(" "),t("li",[s._v("Failed：自动资源回收失败")])])]),s._v(" "),t("li",[s._v("PV挂载参数（Mount Options）\n"),t("ul",[t("li",[s._v("PV挂载到Node上时，根据后端存储特点，可能需要设置额外的挂载参数。目前可以通过在PV的定义中设置一个名为"),t("code",[s._v("volume.beta.kubernetes.io/mount-options")]),s._v("的annotation来实现。")])])])]),s._v(" "),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolume\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pv0003\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("capacity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5Gi\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Filesystem\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteOnce\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeReclaimPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Recycle\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClassName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" slow\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountOptions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" hard\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nfsvers=4.1\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /tmp\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 172.17.0.2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原理","aria-hidden":"true"}},[s._v("#")]),s._v(" 原理")]),s._v(" "),t("p",[t("font",{attrs:{color:"red"}},[s._v("pv对象怎么变成容器中的持久化存储？")])],1),s._v(" "),t("blockquote",[t("p",[s._v("持久化volume需要满足两个条件：")]),s._v(" "),t("ul",[t("li",[s._v("容器删除，持久化volume不会删除")]),s._v(" "),t("li",[s._v("容器重建，绑定的还是之前的volume")])])]),s._v(" "),t("p",[s._v("持久化宿主机目录的过程，分为两个阶段：")]),s._v(" "),t("p",[s._v("阶段1：Attach")]),s._v(" "),t("blockquote",[t("p",[s._v("pod调度到某个节点，kubelet负责为这个Pod创建它的Volume，默认情况下，kubelet创建的Volume在宿主机上的目录为：")]),s._v(" "),t("div",{staticClass:"language-markdown line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-markdown"}},[t("code",[s._v("/var/lib/kubelet/pods/"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Pod的ID")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("/volumes/kubernetes.io~"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Volume类型")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("/"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Volume名字")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("p",[s._v("阶段2：Mount")]),s._v(" "),t("blockquote",[t("p",[s._v("将远程存储服务器目录挂载到Volume的宿主机目录上。这样，你在宿主机目录写入的所有文件，都会保存到远程存储服务目录上。")]),s._v(" "),t("p",[s._v("这个过程由VolumeManagerReconciler控制，它允许起来后，是一个独立于kubelet主循环的Coroutine。")])]),s._v(" "),t("p",[s._v("经过两个阶段的处理，就得到了一个持久化的Volume的宿主机目录，接下来，kubelet就把这个Volume目录通过CRI里的Mounts参数，传递给Docker，然后，就可以为Pod中的容器挂载这个持久化的Volume了。")]),s._v(" "),t("blockquote",[t("p",[s._v("另外，volume的处理流程和Pod及容器的请求流程没有太多的耦合，只要kubelet在向CRI发请求之前，确保持久化目录准备好了。")])]),s._v(" "),t("h3",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网-PV"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"pvc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pvc","aria-hidden":"true"}},[s._v("#")]),s._v(" PVC")]),s._v(" "),t("p",[s._v("PVC是用户对存储资源的需求申请。它描述的是Pod所希望使用的持久化存储的属性。主要包括：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("资源请求（Resources）")]),s._v(" "),t("ul",[t("li",[s._v("目前仅支持"),t("code",[s._v("request.storage")]),s._v("的设置，即存储空间大小")])])]),s._v(" "),t("li",[t("p",[s._v("访问模式（Access Modes）")]),s._v(" "),t("ul",[t("li",[s._v("描述用户对存储资源的访问权限")])])]),s._v(" "),t("li",[t("p",[s._v("PV选择条件（Selector）")]),s._v(" "),t("ul",[t("li",[s._v("通过Label Selector的设置，是PVC对系统中已存在的PV进行筛选，系统将根据标签选择出合适的PV与PVC进行绑定。")]),s._v(" "),t("li",[s._v("选择条件：使用"),t("code",[s._v("matchLabels")]),s._v("和"),t("code",[s._v("matchExpressions")]),s._v("进行设置")])])]),s._v(" "),t("li",[t("p",[s._v("存储类别（Class）")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("设置需要的后端存储类别（通过storageClassName字段指定）")])]),s._v(" "),t("li",[t("p",[s._v("你也可以设定为空，这时系统会选取未设定Class的PV与之绑定。")])]),s._v(" "),t("li",[t("p",[s._v("你也可以不指定。系统会根据是否启用"),t("code",[s._v("DefaultStorageClass")]),s._v("的admission controller进行相应操作")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("未启用。等效"),t("code",[s._v('stoageClassName = ""')])])]),s._v(" "),t("li",[t("p",[s._v("以启用。需要管理员已定义默认StorageClass，")]),s._v(" "),t("ul",[t("li",[s._v("如果不存在，等效未启用。")]),s._v(" "),t("li",[s._v("如果存在，系统将自动为PVC创建御姐PV（使用默认StorageClass的后端存储），并将它们进行绑定。")])])]),s._v(" "),t("li",[t("p",[s._v("设置默认StorageClass方法。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("在StorageClass的定义中加annotation：")]),s._v(" "),t("p",[t("code",[s._v("storageclass.kubernetes.io/is-default-class=true")])])]),s._v(" "),t("li",[t("p",[s._v("默认存储类只能创建一个。")])])])])])])])])]),s._v(" "),t("h2",{attrs:{id:"pv和pvc生命周期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pv和pvc生命周期","aria-hidden":"true"}},[s._v("#")]),s._v(" PV和PVC生命周期")]),s._v(" "),t("h3",{attrs:{id:"资源供应"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源供应","aria-hidden":"true"}},[s._v("#")]),s._v(" 资源供应")]),s._v(" "),t("p",[s._v("两种资源供应模式：静态模式（Static）和动态模式（Dynamic），资源供应的结果就是创建好的PV")]),s._v(" "),t("ul",[t("li",[s._v("静态模式：管理员手工创建许多PV，定义PV时将后端存储的特性进行设置")]),s._v(" "),t("li",[s._v("动态模式：无需手工创建PV。而是通过StorageClass的设置对后端存储进行描述，标记为某种“类型”，此时要求PVC对存储的类型进行声明，系统自动完成PV的创建和PVC的绑定。PVC可以声明class为“”，说明PVC禁止使用动态模式。")])]),s._v(" "),t("h3",{attrs:{id:"资源绑定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源绑定","aria-hidden":"true"}},[s._v("#")]),s._v(" 资源绑定")]),s._v(" "),t("p",[s._v("用户定义好PVC后，系统根据PVC对资源的请求，去寻找满足要求的PV。")]),s._v(" "),t("ul",[t("li",[s._v("一旦找到，就将PV与用户定义的PVC绑定。PV被PVC独占，不能再被其他PVC绑定，此种情况下，可能造成PV资源的浪费。")]),s._v(" "),t("li",[s._v("没有找到，PVC无限期处于Pending状态，直到等到系统管理员创建了一个符合要求的PV。")])]),s._v(" "),t("h3",{attrs:{id:"资源使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源使用","aria-hidden":"true"}},[s._v("#")]),s._v(" 资源使用")]),s._v(" "),t("p",[s._v("pod使用volume的定义，将PVC挂载到容器内的某个路径进行使用。volume的类型"),t("code",[s._v("persistentVolumeClaim")]),s._v("。多个pod可以挂载同一个PVC，应用程序需要考虑多个实例访问一块存储空间的问题。")]),s._v(" "),t("h3",{attrs:{id:"资源释放"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源释放","aria-hidden":"true"}},[s._v("#")]),s._v(" 资源释放")]),s._v(" "),t("p",[s._v("用户使用完存储资源后，用户可以删除PVC，与该PVC绑定的PV将会被标记为“已释放”，但还不能立刻与其他PVC进行绑定，因为之前PVC的数据还留在存储设备上，只有清除之后该PV才能再次使用。")]),s._v(" "),t("h3",{attrs:{id:"资源回收"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源回收","aria-hidden":"true"}},[s._v("#")]),s._v(" 资源回收")]),s._v(" "),t("p",[s._v("对于PV，管理员可以设置回收策略（Reclaim Policy），用于设置与之绑定的PVC释放资源之后，遗留数据如何处理，只有PV的存储空间完成回收，才能供新的PVC绑定和使用。")]),s._v(" "),t("h2",{attrs:{id:"storageclass"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#storageclass","aria-hidden":"true"}},[s._v("#")]),s._v(" StorageClass")]),s._v(" "),t("p",[s._v("StorageClass：对存储资源的抽象定义。对用户的PVC屏蔽后端存储的细节。一方面减轻用户对存储资源细节的关注，另一方面，减轻管理员手工管理PV的工作。由系统自动完成PV的创建和绑定，实现了动态的资源供应。")]),s._v(" "),t("p",[s._v("StorageClass定义：")]),s._v(" "),t("ul",[t("li",[s._v("后端存储提供者（Provisioner）")]),s._v(" "),t("li",[s._v("后端存储相关参数")])]),s._v(" "),t("p",[s._v("**注意：**StorageClass一旦创建出来，无法修改，如需修改，只能删除原StorageClass定义。")]),s._v(" "),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StorageClass\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" storage.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" standard\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provisioner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubernetes.io/aws"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ebs\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gp2\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("reclaimPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Retain\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountOptions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" debug\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeBindingMode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Immediate\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("设置默认StorageClass")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("首先启用"),t("code",[s._v("DefaultStorageClass")]),s._v("的admission controller，即：在kube-apiserver的命令行参数")]),s._v(" "),t("p",[t("code",[s._v("--adminission-control")]),s._v("中添加：")]),s._v(" "),t("p",[t("code",[s._v("--adminission-control=..., DefaultStorageClass")])]),s._v(" "),t("p",[s._v("然后，在StorageClass定义中设置annotation：")]),s._v(" "),t("p",[t("code",[s._v('stoageclass.beta.kubernetes.io/is-default-class="true"')])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改默认storageclass，参考官网")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("kubectl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v('patch storageclass <your-class-name> -p \'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])])])]),s._v(" "),t("h3",{attrs:{id:"参考-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考-2","aria-hidden":"true"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网-StorageClass"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.jianshu.com/p/b5fb31424c09",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ceph在Kubernetes中的一些应用"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/administer-cluster/change-default-storage-class/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网-Change the default StorageClass"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"volumeclaimtemplates"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#volumeclaimtemplates","aria-hidden":"true"}},[s._v("#")]),s._v(" volumeClaimTemplates")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("作用：容器在使用volumes的时候，动态创建和映射容器与PVC的关系。")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeClaimTemplates")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rabbitmq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pvc\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volume.beta.kubernetes.io/storage-class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' "ceph'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('storageclass" //和下面的配置二选一\n      '),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteOnce"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClassName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ceph-storageclass"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 50Gi\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"subpath"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#subpath","aria-hidden":"true"}},[s._v("#")]),s._v(" subPath")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("作用：有时，可以在一个pod中，将同一个卷共享，使其有多个用处。volumeMounts.subPath特性可以用来指定卷中的一个子目录，而不是直接使用卷的根目录。")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("site\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/lib/mysql\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" site"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" php\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" php\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/www/html\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" site"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" html\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" site"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeClaim")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("claimName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("site"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("blockquote",[t("p",[s._v("个人理解：共享一个卷的时候，需要在卷中建立多个子目录以区分，而subPath就是在卷中指定子目录。")])])])])])},[],!1,null,null,null);a.default=n.exports}}]);