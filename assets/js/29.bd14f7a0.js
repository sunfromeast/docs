(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{250:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"secret资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secret资源","aria-hidden":"true"}},[t._v("#")]),t._v(" Secret资源")]),t._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("secret资源作用：")]),t._v(" "),s("blockquote",[s("p",[t._v("专用于存储敏感数据，如：密码、数字证书、私钥、token、SSH key等。")])]),t._v(" "),s("p",[t._v("secret资源用途：")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("作为存储卷注入pod中供容器中的应用程序使用。")]),t._v(" "),s("li",[t._v("保存私有仓库的认证信息供pod拉取私有仓库镜像时使用。（注：拉取私有仓库镜像也可以使用serviceaccount资源自建的secret对象，更加安全）")])])]),t._v(" "),s("p",[t._v("secret资源的一些说明：")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("以键值对的方式存储数据，存储和打印格式为Base64编码")]),t._v(" "),s("li",[t._v("在pod中引用secret时，可以通过"),s("strong",[t._v("环境变量或者存储卷挂载")]),t._v("两种方式。容器使用时会自动解码为明文。")]),t._v(" "),s("li",[t._v("secret的位置：secret存在于引用它的pod所在的node上，且由该node存储于内存中")])])]),t._v(" "),s("h2",{attrs:{id:"secret资源类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secret资源类型","aria-hidden":"true"}},[t._v("#")]),t._v(" Secret资源类型")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("Opaque")])]),t._v(" "),s("td",[t._v("用于存储密码、秘钥、信息、证书等自定义数据内容，类型表示："),s("strong",[t._v("generic")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("kubernetes.io/service-account-token")])]),t._v(" "),s("td",[t._v("存储ServiceAccount的认证信息，创建ServiceAccount由kubernetes自动创建")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("kubernetes.io/dockerconfigjson")])]),t._v(" "),s("td",[t._v("用于存储私有docker镜像仓库的认证信息，类型标识："),s("strong",[t._v("docker-registry")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("kubernetes.io/tls")])]),t._v(" "),s("td",[t._v("用于存储SSL通信时使用的证书和私钥文件，类型标识："),s("strong",[t._v("tls")])])])])]),t._v(" "),s("h2",{attrs:{id:"创建secret资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建secret资源","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建Secret资源")]),t._v(" "),s("p",[t._v("两种创建方式："),s("code",[t._v("kubectl create")]),t._v("命令行方式和secrets配置文件方式。")]),t._v(" "),s("h3",{attrs:{id:"命令行方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#命令行方式","aria-hidden":"true"}},[t._v("#")]),t._v(" 命令行方式")]),t._v(" "),s("div",{staticClass:"language-markdown line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-markdown"}},[s("code",[t._v("kubectl create secret "),s("span",{pre:!0,attrs:{class:"token url"}},[t._v("["),s("span",{pre:!0,attrs:{class:"token content"}},[t._v("type")]),t._v("] ["),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("secret-name")]),t._v("]")]),t._v(" ...\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("blockquote",[s("p",[t._v("其中：")]),t._v(" "),s("p",[t._v("type：取值：generic、docker-registry、tls")])]),t._v(" "),s("ol",[s("li",[s("p",[s("font",{attrs:{color:"red"}},[t._v("创建generic类型Secret")])],1),t._v(" "),s("div",{staticClass:"language-markdown line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-markdown"}},[s("code",[s("span",{pre:!0,attrs:{class:"token title important"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("#")]),t._v(" 1. 使用--from-literal，从字面量获取值")]),t._v("\nkubectl create secret generic mysqlauth --from-literal=username=root --from-literal=password=root\n\n"),s("span",{pre:!0,attrs:{class:"token title important"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("#")]),t._v(" 2. 使用--from-file，从文件加载数据")]),t._v("\nkubectl create secret generic ssh-key-secret --from-file=ssh-privatekey=./private.key --from-file=ssh-publickey=./public.key\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("blockquote",[s("p",[t._v("base64加密的信息可以使用："),s("code",[t._v("echo <encryptcontent> | base 64 -d")]),t._v("解密查看")])])]),t._v(" "),s("li",[s("p",[s("font",{attrs:{color:"red"}},[t._v("创建tls类型的Secret")])],1),t._v(" "),s("div",{staticClass:"language-markdown line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-markdown"}},[s("code",[t._v("kubectl create secret tls nginx-tls --key=./nginx.key --cert=./nginx.crt\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("blockquote",[s("p",[t._v("创建tls类型secret时需要传入：证书和私钥。无论你使用的证书和私钥是什么名字，在secret对象中它们将一律被转换为"),s("code",[t._v("tls.key")]),t._v("和"),s("code",[t._v("tls.crt")])])])]),t._v(" "),s("li",[s("p",[s("font",{attrs:{color:"red"}},[t._v("创建docker-registry类型的Secret（imagePullSecret）")])],1),t._v(" "),s("p",[t._v("这种类型的secret主要用于辅助kubelet从需要认证的仓库中获取镜像，它通过将Secret提供的密码传递给kubelet从而在拉取镜像之前完成必要的认证。")]),t._v(" "),s("p",[t._v("这种secret的使用有两种方式：")]),t._v(" "),s("ul",[s("li",[t._v("创建docker-registry类型secret，在创建pod使用"),s("code",[t._v("imagePullSecrets")]),t._v("字段明确给出。")]),t._v(" "),s("li",[t._v("创建docker-registry类型secret，将其添加到特定的ServiceAccount对象中，使用该ServiceAccount创建的pod对象将默认使用secret中的认证信息。")])]),t._v(" "),s("p",[t._v("第一种方式：")]),t._v(" "),s("div",{staticClass:"language-markdown line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-markdown"}},[s("code",[t._v("kubectl create secret docker-registry my-registry --namespace=xx --docker-server=xx --docker-username=root --docker-password=root --docker-emial=1099347495@qq.com\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("blockquote",[s("p",[t._v("其中：")]),t._v(" "),s("p",[t._v("--docker-username：登录仓库的用户名")]),t._v(" "),s("p",[t._v("--docker-password：登录仓库的密码")]),t._v(" "),s("p",[t._v("使用方式：在pod的yaml清单的"),s("code",[t._v(".spec.imagePullSecrets")]),t._v("列表中指定该secret的名字")])])])]),t._v(" "),s("h3",{attrs:{id:"清单式创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#清单式创建","aria-hidden":"true"}},[t._v("#")]),t._v(" 清单式创建")]),t._v(" "),s("p",[t._v("Secret作为标准的Kubernetes API对象，除了标准的apiVersion、kind、metadata外，还可以使用如下字段：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("字段")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("data")]),t._v(" "),s("td",[s("code",[t._v("key:value")]),t._v("形式存储数据，字符串需要使用Base64格式编码")])]),t._v(" "),s("tr",[s("td",[t._v("stringData")]),t._v(" "),s("td",[t._v("明文存储，创建secret时自动编码保存在data字段中，明文不会输出")])]),t._v(" "),s("tr",[s("td",[t._v("type")]),t._v(" "),s("td",[t._v("secret的类型")])])])]),t._v(" "),s("p",[t._v("例如：")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" secret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("demo\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stringData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Opaque\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h2",{attrs:{id:"secret引用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secret引用","aria-hidden":"true"}},[t._v("#")]),t._v(" Secret引用")]),t._v(" "),s("h3",{attrs:{id:"环境变量方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境变量方式","aria-hidden":"true"}},[t._v("#")]),t._v(" 环境变量方式")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" secret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mycontainer\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SECRET_USERNAME\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysecret\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" username\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br")])]),s("h3",{attrs:{id:"存储卷方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#存储卷方式","aria-hidden":"true"}},[t._v("#")]),t._v(" 存储卷方式")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" secret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("volume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mycontainer\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n   \t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   \t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redisconfig\n   \t  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/mysecret\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redisconfig\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secret")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysecret\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br")])])])},[],!1,null,null,null);e.default=n.exports}}]);