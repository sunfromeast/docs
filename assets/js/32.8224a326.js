(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{246:function(e,t,a){"use strict";a.r(t);var s=a(0),n=Object(s.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"serviceaccount自动化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#serviceaccount自动化","aria-hidden":"true"}},[e._v("#")]),e._v(" ServiceAccount自动化")]),e._v(" "),a("p",[e._v("Kubernetes中创建的每一个Pod都自动挂载了一个存储卷在容器的"),a("code",[e._v("/var/run/secrets/kubernetes.io/serviceaccount")]),e._v("目录，该目录下存在三个文件，分别是：")]),e._v(" "),a("ul",[a("li",[e._v("ca.crt")]),e._v(" "),a("li",[e._v("namespace")]),e._v(" "),a("li",[e._v("token：保存ServiceAccount对象的认证token，容器中应用进程使用它向APIServer发起请求。")])]),e._v(" "),a("p",[e._v("Kubernetes系统通过三个独立的组件间相互协作来实现服务账户的自动化：")]),e._v(" "),a("ul",[a("li",[e._v("Service Account准入控制器")]),e._v(" "),a("li",[e._v("token controller令牌控制器")]),e._v(" "),a("li",[e._v("Service Account账户控制器")])]),e._v(" "),a("h3",{attrs:{id:"service-account准入控制器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-account准入控制器","aria-hidden":"true"}},[e._v("#")]),e._v(" Service Account准入控制器")]),e._v(" "),a("p",[e._v("Service Account是APIServer的一部分，负责创建或更新Pod时对其按需进行ServiceAccount对象相关信息的修改。包括：")]),e._v(" "),a("ul",[a("li",[e._v("Pod若没有明确指定使用ServiceAccount对象，则将其设置为“default”。反之，则拒绝请求。")]),e._v(" "),a("li",[e._v("Pod不含imagePullSecrets，则把ServiceAccount对象的ImagePullSecrets添加其上。")]),e._v(" "),a("li",[e._v("为pod添加secret类型的volume用于保存token，并将其挂载到容器内的"),a("code",[e._v("/var/run/secrets/kubernetes.io/serviceaccount")]),e._v("目录。")])]),e._v(" "),a("h3",{attrs:{id:"token-controller令牌控制器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#token-controller令牌控制器","aria-hidden":"true"}},[e._v("#")]),e._v(" token controller令牌控制器")]),e._v(" "),a("p",[e._v("其完成的任务为：")]),e._v(" "),a("ul",[a("li",[e._v("监控Service Account对象的创建，并为其添加对应的用于访问API的Secret对象。")]),e._v(" "),a("li",[e._v("监控Service Account对象的删除，并删除对应的secret对象。")]),e._v(" "),a("li",[e._v("监控secret对象的添加，确保其引用的Service Account对象存在")]),e._v(" "),a("li",[e._v("监控secret对象的删除，并删除Service Account对象对此secret的引用。")])]),e._v(" "),a("h2",{attrs:{id:"创建serviceaccount对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建serviceaccount对象","aria-hidden":"true"}},[e._v("#")]),e._v(" 创建ServiceAccount对象")]),e._v(" "),a("p",[e._v("一个pod只能有一个ServiceAccount对象，但一个ServiceAccount对象可以由多个pod共享。创建pod时，可以使用"),a("code",[e._v(".spec.serviceAccountName")]),e._v("属性直接引用要使用的ServiceAccount对象。当然，如果你不指定，默认使用的是当前命名空间中默认的ServiceAccount对象。")]),e._v(" "),a("p",[e._v("创建ServiceAccount对象有命令行和配置文件两种方式：")]),e._v(" "),a("div",{staticClass:"language-markdown line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-markdown"}},[a("code",[e._v("kubectl create serviceaccount mytest -n kube-system\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("配置清单方式：")]),e._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ServiceAccount\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" mytest\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("system\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("h2",{attrs:{id:"调用imagepullsecret对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用imagepullsecret对象","aria-hidden":"true"}},[e._v("#")]),e._v(" 调用imagePullSecret对象")]),e._v(" "),a("p",[e._v("pod从私有仓库拉取镜像时需要进行认证，除了可以在pod清单文件的"),a("code",[e._v(".spec.imagePullSecrets")]),e._v("中指定secret外，还可以在ServiceAccount中指定。")]),e._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ServiceAccount\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" mytest\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("system\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("imagePullSecrets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("harbor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("secret\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])])])},[],!1,null,null,null);t.default=n.exports}}]);