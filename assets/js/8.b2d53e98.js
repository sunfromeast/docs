(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{197:function(s,a,t){s.exports=t.p+"assets/img/pod-infra.f196eb15.png"},218:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"pod的yaml文件定义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pod的yaml文件定义","aria-hidden":"true"}},[s._v("#")]),s._v(" pod的yaml文件定义")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" two"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("containers\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Never\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" shared"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      \n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /data\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" shared"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/share/nginx/html\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" debian"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" debian\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" shared"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo Hello from the debian container > /pod-data/index.html"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("pod中的几个重要字段：除了传统的apiVersion、kind、metadta、spec、status外")]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v(".spec.hostAliases")]),s._v("：定义pod中hosts（/etc/hosts）内容")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("apiVersion: v1\nkind: Pod\n...\nspec:\n  hostAliases:\n  "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(' ip: "10.1.2.3"\n    hostnames:\n    '),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(' "foo.remote"\n    '),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(' "bar.remote"\n...\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v(".spec.containers.lifecycle")]),s._v("：定义容器生命周期钩子，在容器生命周期中，当容器的状态发生改变时，将触发一系列钩子。")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: lifecycle-demo\nspec:\n  containers:\n  "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(' name: lifecycle-demo-container\n    image: nginx\n    lifecycle:\n      postStart:\n        exec:\n          command: ["/bin/sh", "-c", "echo Hello from the postStart handler > /usr/share/message"]\n      preStop:\n        exec:\n          command: ["/usr/sbin/nginx","-s","quit"]\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("blockquote",[n("ul",[n("li",[s._v("postStart：定义容器启动后立即执行的动作。不过注意，这个动作和容器的ENTRYPOINT并不是同步的，换句话说，它不保证顺序，postStart启动时，ENTRYPOINT可能还没有结束。")]),s._v(" "),n("li",[s._v("preStop：定义容器杀死前执行的动作。preStop和杀死容器是同步阻塞的，也就是说，preStop没有执行完成，那么杀死容器就不能执行。")])])])])]),s._v(" "),n("h2",{attrs:{id:"pod的原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pod的原理","aria-hidden":"true"}},[s._v("#")]),s._v(" pod的原理")]),s._v(" "),n("ul",[n("li",[n("p",[n("font",{attrs:{color:"red"}},[s._v("pod的一个重要事实：它只是一个逻辑概念。")])],1),s._v(" "),n("blockquote",[n("p",[s._v("kubernetes真正处理的，还是宿主机上的Linux容器的namespace和cgroups。并不存在所谓的pod边界或者隔离环境。pod实际上是一组共享了资源的容器。具体的说，pod中的所有容器共享了同一个Network Namespace和相同的volume。")])])]),s._v(" "),n("li",[n("p",[n("font",{attrs:{color:"red"}},[s._v("既然是共享Network Space和volume，那么是A共享B、还是B共享A，还是其他方式呢？")])],1),s._v(" "),n("blockquote",[n("p",[s._v("假如，有包含A和B两个容器的pod，如果容器A共享容器B的资源，那么：")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("docker run --net=B --volumes-from=B --name=A image-A\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("如果真是这样的话，需要容器B在容器A之前启动，A和B就不是对等关系，而变成拓扑关系了。所以，pod的实现需要一个中间容器。")])])]),s._v(" "),n("li",[n("p",[n("font",{attrs:{color:"red"}},[s._v("实现pod的中间容器：")])],1),s._v(" "),n("blockquote",[n("p",[s._v("实现pod的中间容器，也叫Infra容器（镜像是"),n("code",[s._v("k8s.gcr.io/pause")]),s._v("，镜像很小，容器处于暂停状态）。一个pod中Infra容器是第一个被启动的容器。用户定义的容器，通过Join Network Namespace，与Infra容器关联在一起。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(197),alt:""}})]),s._v(" "),n("p",[s._v("也就是说，对容器A和B来说：")]),s._v(" "),n("ul",[n("li",[s._v("可以直接使用localhost通信，因为他们都共享的是Infra的网络命名空间")]),s._v(" "),n("li",[s._v("一个Pod对应一个IP地址，也就是Pod的Network Namespace对应的IP地址。")]),s._v(" "),n("li",[s._v("Pod的生命周期只和Infra容器一致，与容器A和B无关。")])])])])]),s._v(" "),n("h2",{attrs:{id:"pod资源对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pod资源对象","aria-hidden":"true"}},[s._v("#")]),s._v(" pod资源对象")]),s._v(" "),n("p",[s._v("pod资源对象用于运行单个容器化的应用，此应用称为pod对象的主容器，当然，pod也能同时容纳多个容器，额外的容器一般的工作模型有一下几种：")]),s._v(" "),n("h3",{attrs:{id:"sidecar模型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sidecar模型","aria-hidden":"true"}},[s._v("#")]),s._v(" Sidecar模型")]),s._v(" "),n("p",[s._v("这个模型是为pod中的主容器提供协同的辅助应用容器。例如：主应用容器中的日志使用agent收集到日志服务器中，agent作为辅助应用容器。")]),s._v(" "),n("h3",{attrs:{id:"ambassador模型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ambassador模型","aria-hidden":"true"}},[s._v("#")]),s._v(" Ambassador模型")]),s._v(" "),n("p",[s._v("这个模型是为远程服务在pod中创建一个本地代理，pod中的主容器通过代理容器访问远程服务。例如：主应用容器访问远程一主多从模型的远程Redis应用时，可以在当前容器中为远程Redis创建一个本地代理Ambassador container，主应用容器直接通过localhost接口访问Ambassador接口即可，这样，Redis有修改的话，不用修改主容器，只需要修改这个代理容器即可。")]),s._v(" "),n("h3",{attrs:{id:"adapter模型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#adapter模型","aria-hidden":"true"}},[s._v("#")]),s._v(" Adapter模型")]),s._v(" "),n("p",[s._v("一般用于不兼容时做适配，如：容器日志格式化输出。")]),s._v(" "),n("h2",{attrs:{id:"pod的生命周期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pod的生命周期","aria-hidden":"true"}},[s._v("#")]),s._v(" pod的生命周期")]),s._v(" "),n("h3",{attrs:{id:"几个状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#几个状态","aria-hidden":"true"}},[s._v("#")]),s._v(" 几个状态")]),s._v(" "),n("p",[s._v("pod在生命周期中有一下几个状态：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("状态")]),s._v(" "),n("th",[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("pending")]),s._v(" "),n("td",[s._v("API Server创建pod资源对象已经存入etcd，尚未调度完成或正在下载镜像")])]),s._v(" "),n("tr",[n("td",[s._v("Running")]),s._v(" "),n("td",[s._v("pod已被调度，所有容器都已被kubelet创建完成")])]),s._v(" "),n("tr",[n("td",[s._v("Successed")]),s._v(" "),n("td",[s._v("pod中所有容器都已经终止并不会重启")])]),s._v(" "),n("tr",[n("td",[s._v("Failed")]),s._v(" "),n("td",[s._v("所有容器都已终止，且至少一个非正常终止（返回非0值）")])]),s._v(" "),n("tr",[n("td",[s._v("Unknown")]),s._v(" "),n("td",[s._v("APIServer无法获取pod的状态信息，通常是无法和工作节点上的kubelet通信所致")])])])]),s._v(" "),n("h3",{attrs:{id:"pod创建过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pod创建过程","aria-hidden":"true"}},[s._v("#")]),s._v(" pod创建过程")]),s._v(" "),n("ol",[n("li",[s._v("客户端（kubectl等）提交pod spec给APIServer。")]),s._v(" "),n("li",[s._v("APIServer尝试将pod对象的相关信息写入etcd，写入操作完成，APIServer会返回信息给客户端。")]),s._v(" "),n("li",[s._v("APIServer将会一直反映etcd中的状态变化\n"),n("ol",[n("li",[s._v("kubernetes所有组件均使用“watch”机制跟踪检查APIServer上的相关变动。")]),s._v(" "),n("li",[s._v("kube-scheduler的“watcher”察觉到APIServer创建了一个新的pod，还没有绑定到任何节点，然后，它就为pod挑选了一个工作节点并将信息更新至APIServer。")]),s._v(" "),n("li",[s._v("APIServer将调度结果更新至etcd，同时，它会反映出pod对象的调度结果。")]),s._v(" "),n("li",[s._v("pod所在节点上的kubelet尝试在当前节点调用docker启动容器，并将容器的启动状态返回给APIServer。")]),s._v(" "),n("li",[s._v("APIServer将pod状态信息存入etcd系统中，将存储结果发送到相关的kubelet。")])])])]),s._v(" "),n("h2",{attrs:{id:"projected-volume"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#projected-volume","aria-hidden":"true"}},[s._v("#")]),s._v(" Projected Volume")]),s._v(" "),n("p",[n("font",{attrs:{color:"red"}},[s._v("Projected Volume")])],1),s._v(" "),n("blockquote",[n("p",[s._v("为容器提供预先定义好的数据。（不是存放容器里的数据，也不是进行容器和宿主机之间的数据交换）、")])]),s._v(" "),n("p",[n("font",{attrs:{color:"red"}},[s._v("Projected Volume支持的四种类型：")])],1),s._v(" "),n("blockquote",[n("ul",[n("li",[s._v("Secret")]),s._v(" "),n("li",[s._v("ConfigMap")]),s._v(" "),n("li",[s._v("Downward API")]),s._v(" "),n("li",[s._v("ServiceAccountToken")])])]),s._v(" "),n("h3",{attrs:{id:"secret"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#secret","aria-hidden":"true"}},[s._v("#")]),s._v(" "),n("font",{attrs:{color:"red"}},[s._v("Secret")])],1),s._v(" "),n("p",[s._v("一般保存的是密码信息")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("projected"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume \n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("secret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" sleep\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"86400"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cred\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/projected-volume"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("readOnly")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cred\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("projected")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" user\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pass\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("cat ./username.txt\nadmin\n$ cat ./password.txt\nc1oudc0w!\n\n$ kubectl create secret generic user --from-file=./username.txt\n$ kubectl create secret generic pass --from-file=./password.txt\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"configmap"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#configmap","aria-hidden":"true"}},[s._v("#")]),s._v(" "),n("font",{attrs:{color:"red"}},[s._v("ConfigMap")])],1),s._v(" "),n("p",[s._v("一般保存的是应用的配置信息，用法和secret类似。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .properties 文件的内容")]),s._v("\n$ cat example/ui.properties\ncolor.good=purple\ncolor.bad=yellow\nallow.textmode=true\nhow.nice.to.look=fairlyNice\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从.properties 文件创建 ConfigMap")]),s._v("\n$ kubectl create configmap ui"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("from"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("file=example/ui.properties\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看这个 ConfigMap 里保存的信息 (data)")]),s._v("\n$ kubectl get configmaps ui"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o yaml\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ui.properties")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true\n    how.nice.to.look=fairlyNice")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConfigMap\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ui"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h3",{attrs:{id:"downward-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#downward-api","aria-hidden":"true"}},[s._v("#")]),s._v(" "),n("font",{attrs:{color:"red"}},[s._v("Downward API")])],1),s._v(" "),n("p",[s._v("作用：让pod里的容器可以直接获取到这个Pod API对象本身的信息")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("downwardapi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("zone")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" us"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("est"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("coast\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rack")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" k8s.gcr.io/busybox\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" while true; do\n          if "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("e /etc/podinfo/labels "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n            echo "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("en '\\n\\n'; cat /etc/podinfo/labels; fi;\n          sleep 5;\n        done;\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" podinfo\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/podinfo\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("readOnly")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" podinfo\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("projected")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("downwardAPI")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("items")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"labels"')]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metadata.labels\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("p",[s._v("暴露了Pod的metadata.labels信息给容器")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("kubectl create "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f dapi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume.yaml\n$ kubectl logs test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("downwardapi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('volume\ncluster="test'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('cluster1"\nrack="rack'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('22"\nzone="us'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("est"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('coast"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("blockquote",[n("p",[s._v("注意：")]),s._v(" "),n("ol",[n("li",[s._v("Downward API能够获取到的信息，一定是Pod里的容器进程启动之前能够确定下来的信息。")])])]),s._v(" "),n("h3",{attrs:{id:"service-account"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service-account","aria-hidden":"true"}},[s._v("#")]),s._v(" "),n("font",{attrs:{color:"red"}},[s._v("Service Account")])],1),s._v(" "),n("p",[s._v("​\t解决服务访问Kubernetes时，APIServer对服务的授权。Service Account是一种特殊的Secret，叫做ServiceAccountToken。它里面保存的是APIServer的授权信息，也就是token，有这个token，才可以合法方二万APIServer。")]),s._v(" "),n("p",[s._v("​\t在每个pod中，有一个名为：default-token-xxx的volume，自动挂载在每个容器的一个固定目录上。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("$ kubectl describe pod test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("projected"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume \n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql-cred")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                Projected (a volume that contains injected data from multiple sources)\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SecretName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("          user\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SecretOptionalName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  <nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SecretName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("          pass\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SecretOptionalName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  <nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default-token-hmh97")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("        Secret (a volume populated by a Secret)\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SecretName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("hmh97\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Optional")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Mounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      /projected"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume from mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cred (ro)\n      /var/run/secrets/kubernetes.io/serviceaccount from default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("hmh97 (ro)\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("然后，容器就可以从"),n("code",[s._v("/var/run/secrets/kubernetes.io/serviceaccount")]),s._v("读取授权信息")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("ls /var/run/secrets/kubernetes.io/serviceaccount \nca.crt namespace  token\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"podpreset-pod预设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#podpreset-pod预设置","aria-hidden":"true"}},[s._v("#")]),s._v(" PodPreset(Pod预设置)")]),s._v(" "),n("p",[s._v("为pod默认填充内容")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" settings.k8s.io/v1alpha1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PodPreset\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" allow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" frontend\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DB_PORT\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6379"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /cache\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("emptyDir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("blockquote",[n("p",[s._v("说明：")]),s._v(" "),n("ul",[n("li",[s._v("PodPreset 里定义的内容，只会在Pod对象创建之前追加在这个对象本身上，不会影响任何Pod的控制器的定义。")]),s._v(" "),n("li",[s._v("同一个pod的多个PodPreset会合并，冲突字段不会修改。")])])])])},[],!1,null,null,null);a.default=e.exports}}]);