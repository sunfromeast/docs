# 反射

## 什么是反射

定义：反射可以在运行时根据指定的类名获得类的信息。

反射主要提供的功能：

> 1. 运行时判断对象所属的类
> 2. 运行时判断一个类所具有的所有成员变量和方法的信息（包括：其modifiers，superclass，interface，field和method等），从而构造出类的对象或者调用对象的任何一个方法。

## 反射用途

1. IDE智能提示
2. 框架（如：spring）：框架一般需要配置，而为了保证其通用性，可能需要根据不同的配置文件加载不同的类，调用不同的方法，这个时候就需要用到反射。

## 为什么需要反射

java中编译类型有两种：

> 1. 静态编译：编译时确定类型，绑定对象即通过。
>
> 2. 动态编译：运行时确定类型，绑定对象。
>
>    动态编译最大限度的发挥了java的灵活性，体现了多态的应用，可以降低类之间的耦合性。

## 基础类

> 1. Class类：代表一个类
> 2. Field类：代表类的成员变量（类的属性）
> 3. Method类：代表类的方法
> 4. Constructor类：代表类的构造方法
> 5. Array类：提供了动态创建数组，以及访问数组的元素的静态方法

Class类：描述类的类（也就是描述类本身），封装了描述方法的Method，描述变量的Field，描述构造器的Constructor等属性。

> 1. 对于每个类来说，JRE都为其保留了一个不变的Class类型的对象，这个Class对象包含了当前类的所有有关信息。
> 2. Class对象只能由系统建立对象
> 3. 一个类在JVM中只有一个Class实例。

## 基本应用

### 获取Class对象

三种方法：

> 1. 知道类的全限定类名，通过`forName()`
> 2. 通过`类型.class`
> 3. 通过`对象.getClass()`

### 创建对象

两种方式：

> 1. 通过`Class对象.newInstance()`
> 2. 通过`Constructor对象`

### 获取方法

```java
#1 获取指定的public方法，包括继承的方法
public Method getMethod(Stirng name, Class<?>... parameterTypes)
    
#2 获取所有的public方法，包括继承的方法
public Method[] getMethods()
    
#3 获取当前类所声明的指定方法，包括：public，private，protected，default。不包括：继承的任何方法
public Method getDeclaredMethod(String name, Class<?>... parameterTypes)
    
#4 获取当前类所有声明的方法，包括：public，private，protected，default。不包括：继承的任何方法
public Method[] getDeclaredMethods()
```

### 获取字段

> 1. getField：访问公有变量，包括：继承的
> 2. getFields：访问所有公有变量，包括：继承的
> 3. getDeclaredField：访问当前类声明的变量，包括私有变量
> 4. getDeclaredFields：访问当前类声明的所有变量，包括私有变量

### 调用方法

通过`method对象.invoke()`调用方法。

### 创建数组

通过`Array.newInstance()`创建数组

## 代码示例

`Hello.java`

```java
package reflect;

/**
 * @author: ygtao
 * @date: 2019/10/31 12:54
 */
public class Hello {
    public String name;
    private String message;

    public Hello(String name) {
        this.name = name;
    }

    public Hello() {
    }

    public void hello() {
        System.out.println("hello world");
    }

    private void info() {
        System.out.println("name: "+ name);
    }
}
```

`ReflectTest.java`

```java
package reflect;

import java.lang.reflect.*;

/**
 * @author: ygtao
 * @date: 2019/10/31 12:55
 */
public class ReflectTest {
    public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException, NoSuchFieldException {
        //=====================获取Class=================================
        Class hello1 = Class.forName("reflect.Hello");
        Class hello2 = Hello.class;
        Hello myObject = new Hello();
        Class hello3 = myObject.getClass();

        System.out.println("hello1：" + hello1);
        System.out.println("hello2：" + hello2);
        System.out.println("hello3：" + hello3);
        System.out.println("myObject是不是hello1类型的实例：" + hello1.isInstance(myObject));

        //=====================创建对象====================================
        //方式1: Class对象.newInstance()
        Object newInstance = hello2.newInstance();
        //方式2：获取Constructor对象
        Constructor constructor = hello2.getConstructor(String.class);
        Object newInstance1 = constructor.newInstance("ygtao");

        System.out.println("newInstance1：" + newInstance);
        System.out.println("newInstance2：" + newInstance1);

        //====================获取方法======================================
        //获取所有公共方法，包括继承的public方法
        Method[] methods = hello1.getMethods();
        System.out.println("===========================getMethod()==================");
        for (Method method : methods) {
            System.out.println(method.getName());
        }

        //获取所有当前类声明的方法，包括public，private，protected，default
        Method[] declaredMethods = hello1.getDeclaredMethods();
        System.out.println("==========================getDeclaredMethods()=============");
        for (Method method : declaredMethods) {
            System.out.println(method.getName());
        }

        //====================获取变量，用法同获取方法一样=================================
        Field[] fields = hello1.getFields();
        System.out.println("========================getFields()==========================");
        for (Field field : fields) {
            System.out.println(field.getName());
        }
        Field[] declaredFields = hello1.getDeclaredFields();
        System.out.println("=======================getDeclaredFields()====================");
        for (Field field : declaredFields) {
            System.out.println(field.getName());
        }

        //===================调用方法===================================================
        System.out.println("======================调用info.invoke()=========================");
        Method info = hello1.getDeclaredMethod("info");
        Constructor constructor1 = hello1.getConstructor(String.class);
        Object o = constructor1.newInstance("ygtaoo");
        //私有成员要设置访问可见性
        info.setAccessible(true);
        info.invoke(o);

        //===================创建数组===================================================
        System.out.println("=======================创建数组=================================");
        Object array = Array.newInstance(String.class, 3);
        Array.set(array, 0, "hello");
        Array.set(array, 1, "world");
        Array.set(array, 2, "ygtao");
        System.out.println(Array.get(array,2));
    }
}

```

[源代码](https://github.com/sunfromeast/javabase/tree/master/src/reflect)

